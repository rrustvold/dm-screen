<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Blog - Last Haven</title>
    
    <!-- Latest compiled and minified CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    
    <!-- Latest compiled JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    
    <!-- Markdown parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>
    
    <!-- FONTS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" integrity="sha384-tViUnnbYAV00FLIhhi3v/dWt3Jxw4gZQcNoSCxCIFNJVCx7/D55/wXsrNIRANwdD" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Metal+Mania&family=Permanent+Marker&family=Short+Stack&family=Trade+Winds&display=swap" rel="stylesheet">
    
    <style>
        :root{
            --honeyColor: rgb(203, 203, 203);
            --honeyBorderColor: rgba(146, 38, 38, .25);
            --size: 30px;
        }

        .permanent-marker-regular {
            font-family: "Permanent Marker", cursive;
            font-weight: 400;
            font-style: normal;
        }
        .metal-mania-regular {
            font-family: "Metal Mania", system-ui;
            font-weight: 400;
            font-style: normal;
        }
        .trade-winds-regular {
            font-family: "Trade Winds", system-ui;
            font-weight: 400;
            font-style: normal;
        }
        .short-stack-regular {
            font-family: "Short Stack", cursive;
            font-weight: 400;
            font-style: normal;
        }

        a {
            color: rgb(252, 90, 90);
        }

        h1, .h1, h2, .h2, h3, .h3, h4, .h4, h5, .h5 {
            font-family: "Trade Winds";
        }

        .bgimage-1 {
            position: relative;
            min-height: 100vh;
            padding: 0;
            background:
                radial-gradient(circle farthest-side at 0% 50%, var(--honeyColor) 23.5%,transparent 0)calc(var(--size)*0.7) var(--size),
                radial-gradient(circle farthest-side at 0% 50%,var(--honeyBorderColor) 24%,transparent 0)calc(var(--size)*19/30) var(--size),
                linear-gradient(var(--honeyColor) 14%,transparent 0, transparent 85%, var(--honeyColor) 0)0 0,
                linear-gradient(150deg, var(--honeyColor) 24%,var(--honeyBorderColor) 0,var(--honeyBorderColor) 26%,transparent 0,transparent 74%,var(--honeyBorderColor) 0,var(--honeyBorderColor) 76%, var(--honeyColor) 0)0 0,
                linear-gradient(30deg, var(--honeyColor) 24%,var(--honeyBorderColor) 0,var(--honeyBorderColor) 26%,transparent 0,transparent 74%,var(--honeyBorderColor) 0,var(--honeyBorderColor) 76%, var(--honeyColor) 0)0 0,
                linear-gradient(90deg,var(--honeyBorderColor) 2%, var(--honeyColor) 0, var(--honeyColor) 98%,var(--honeyBorderColor) 0%)0 0 var(--honeyColor);
            background-size:calc(var(--size)*4/3) calc(var(--size)*2);
        }

        .blog-content {
            background: rgba(33, 37, 41, 0.9);
            border: 1px solid var(--honeyBorderColor);
            border-radius: 10px;
            padding: 2rem;
            margin: 2rem 0;
            backdrop-filter: blur(5px);
            color: white;
        }

        .blog-post {
            background: rgba(33, 37, 41, 0.8);
            border: 1px solid var(--honeyBorderColor);
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(5px);
            color: white;
        }

        .blog-post h1, .blog-post h2, .blog-post h3 {
            color: var(--honeyColor);
            margin-top: 1.5rem;
            margin-bottom: 1rem;
        }

        .blog-post h1:first-child {
            margin-top: 0;
        }

        .blog-post p, .blog-post li, .blog-post td, .blog-post th {
            color: white;
        }

        .blog-post .table {
            color: white;
        }

        .blog-post .table th {
            border-color: var(--honeyBorderColor);
            color: var(--honeyColor);
        }

        .blog-post .table td {
            border-color: var(--honeyBorderColor);
        }

        .blog-meta {
            color: #6c757d;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid var(--honeyBorderColor);
            padding-bottom: 0.5rem;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--honeyColor);
        }

        .error {
            color: #dc3545;
            text-align: center;
            padding: 2rem;
        }

        .back-link {
            margin-bottom: 2rem;
        }

        .back-link .btn {
            background: rgba(33, 37, 41, 0.9);
            border: 1px solid var(--honeyBorderColor);
            color: var(--honeyColor);
            backdrop-filter: blur(5px);
        }

        .back-link .btn:hover {
            background: rgba(188, 49, 49, 0.719);
            border-color: var(--honeyBorderColor);
            color: #ffffff;
        }
    </style>
</head>
<body>
    <div class="bgimage-1">
        <div class="container">
            <div class="back-link">
                <a href="blog.html" class="btn btn-outline-light">
                    <i class="bi bi-arrow-left"></i> Back to Blog
                </a>
            </div>
            
            <div id="blog-content">
                <div class="loading">
                    <i class="bi bi-hourglass-split"></i> Loading blog posts...
                </div>
            </div>
        </div>

    <script>
        // Configure marked for better rendering
        marked.setOptions({
            breaks: true,
            gfm: true
        });

        // Custom renderer to add Bootstrap classes to tables and handle images
        const renderer = new marked.Renderer();
        
        renderer.table = function(header, body) {
            return `<div class="table-responsive fixed-table-body mt-3 mb-3">
                <table class="table">
                    <thead>${header}</thead>
                    <tbody>${body}</tbody>
                </table>
            </div>`;
        };
        
        renderer.image = function(href, title, text) {
            // Handle images in the blog/images directory
            let src = href;
            if (!href.startsWith('http') && !href.startsWith('/') && !href.startsWith('blog/images/') && !href.startsWith('images/')) {
                src = `blog/images/${href}`;
            }
            
            const titleAttr = title ? ` title="${title}"` : '';
            const altAttr = text ? ` alt="${text}"` : '';
            
            return `<img src="${src}" class="img-fluid rounded mt-3 mb-3"${altAttr}${titleAttr}>`;
        };
        
        marked.setOptions({ renderer: renderer });

        // Get the post parameter from URL
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            var results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }

        // Load and display blog posts
        async function loadBlog() {
            const postParam = getUrlParameter('post');
            
            if (postParam) {
                // Load specific post - show back button
                document.querySelector('.back-link').style.display = 'block';
                document.querySelector('.back-link').innerHTML = `
                <a href="blog.html" class="btn btn-outline-light">
                    <i class="bi bi-arrow-left"></i> Back to Blog Index
                </a>`;
                await loadPost(postParam);
            } else {
                // Load blog index - hide back button
                document.querySelector('.back-link').style.display = 'block';
                document.querySelector('.back-link').innerHTML = `
                <a href="index.html" class="btn btn-outline-light">
                    <i class="bi bi-arrow-left"></i> Back to Last Haven
                </a>`;
                await loadBlogIndex();
            }
        }

        // Load a specific blog post
        async function loadPost(postName) {
            try {
                const response = await fetch(`blog/${postName}.md`);
                if (!response.ok) {
                    throw new Error('Post not found');
                }
                
                const markdown = await response.text();
                const html = marked.parse(markdown);
                
                document.getElementById('blog-content').innerHTML = `
                    <div class="blog-content">
                        <div class="blog-post">
                            ${html}
                        </div>
                    </div>
                `;
                
                // Update page title
                const titleMatch = markdown.match(/^#\s+(.+)$/m);
                if (titleMatch) {
                    document.title = `${titleMatch[1]} - Blog - Last Haven`;
                }
                
            } catch (error) {
                document.getElementById('blog-content').innerHTML = `
                    <div class="error">
                        <i class="bi bi-exclamation-triangle"></i> Error loading post: ${error.message}
                    </div>
                `;
            }
        }

        // Load blog index
        async function loadBlogIndex() {
            try {
                // Load posts from posts.json
                const response = await fetch('blog/posts.json');
                if (!response.ok) {
                    throw new Error('Could not load posts list');
                }
                
                const posts = await response.json();
                
                let html = '<div class="blog-content"><h1 class="permanent-marker-regular mb-4">The Last Haven Blog</h1>';
                
                if (posts.length === 0) {
                    html += '<p class="text-muted">No blog posts yet. Check back soon!</p>';
                } else {
                    // Sort posts by date (newest first)
                    posts.sort((a, b) => new Date(b.date) - new Date(a.date));
                    
                    posts.forEach(post => {
                        html += `
                            <div class="blog-post">
                                <h2><a href="blog.html?post=${post.name}">${post.title}</a></h2>
                                <div class="blog-meta">
                                    <i class="bi bi-calendar"></i> ${post.date}
                                </div>
                                <p>${post.description || ''}</p>
                                <p><a href="blog.html?post=${post.name}" class="btn btn-outline-light btn-sm">Read More</a></p>
                            </div>
                        `;
                    });
                }
                
                html += '</div>';
                document.getElementById('blog-content').innerHTML = html;
                
            } catch (error) {
                document.getElementById('blog-content').innerHTML = `
                    <div class="error">
                        <i class="bi bi-exclamation-triangle"></i> Error loading blog: ${error.message}
                    </div>
                `;
            }
        }

        // Load blog when page loads
        document.addEventListener('DOMContentLoaded', loadBlog);
    </script>
    </div>
</body>
</html>
